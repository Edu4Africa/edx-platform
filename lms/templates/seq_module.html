<%! from django.utils.translation import ugettext as _ %>

<div id="sequence_${element_id}" class="sequence" data-id="${item_id}" data-position="${position}" data-ajax-url="${ajax_url}" >

<%
  in_timed_exam = proctoring_context['in_timed_exam']
  has_started_exam = proctoring_context['has_started_exam']
  has_time_expired = proctoring_context['has_time_expired']
%>

% if has_time_expired:
  <div class="gated-sequence time-expired">
    Sorry, the time has expired on this exam. You can no longer see it!
  </div>
% elif in_timed_exam and not has_started_exam:
  <div class="gated-sequence">
    This is a timed exam. Would you like to <a class='start-timed-exam'>enter</a> it?
  </div>
% else:
  <div class="sequence-nav">
    <button class="sequence-nav-button button-previous"><span class="icon fa fa-chevron-left" aria-hidden="true"></span><span class="sr">${_('Previous')}</span></button>
    <nav class="sequence-list-wrapper" aria-label="${_('Unit')}">
      <ol id="sequence-list">
        % for idx, item in enumerate(items):
        ## TODO (vshnayder): add item.progress_detail either to the title or somewhere else.
        ## Make sure it gets updated after ajax calls.
        ## implementation note: will need to figure out how to handle combining detail
        ## statuses of multiple modules in js.
        <li>
        <a class="seq_${item['type']} inactive progress-${item['progress_status']}"
           data-id="${item['id']}"
           data-element="${idx+1}"
           href="javascript:void(0);"
           title="${item['title']|h}"
           data-page-title="${item['page_title']|h}"
           aria-controls="seq_contents_${idx}"
           id="tab_${idx}"
           tabindex="0">
            <i class="icon fa seq_${item['type']}" aria-hidden="true"></i>
            <p><span class="sr">${item['type']}</span> ${item['title']}</p>
          </a>
        </li>
        % endfor
      </ol>
    </nav>
    <button class="sequence-nav-button button-next"><span class="icon fa fa-chevron-right" aria-hidden="true"></span><span class="sr">${_('Next')}</span></button>
  </div>

  <div class="sr-is-focusable" tabindex="-1"></div>

  % for idx, item in enumerate(items):
  <div id="seq_contents_${idx}"
    aria-labelledby="tab_${idx}"
    aria-hidden="true"
    class="seq_contents tex2jax_ignore asciimath2jax_ignore">
    ${item['content'] | h}
  </div>
  % endfor
  <div id="seq_content"></div>

  <nav class="sequence-bottom" aria-label="${_('Section')}">
    <button class="sequence-nav-button button-previous"><span class="icon fa fa-chevron-left" aria-hidden="true"></span><span class="sr">${_('Previous')}</span></button>
    <button class="sequence-nav-button button-next"><span class="icon fa fa-chevron-right" aria-hidden="true"></span><span class="sr">${_('Next')}</span></button>
  </nav>
% endif
</div>


% if has_time_expired:
<script type="text/javascript">
</script>
% elif in_timed_exam and not has_started_exam:
<script type="text/javascript">
  $('.start-timed-exam').click(
    function(event) {
      var target = $(event.target);
      var action_url = target.parent().parent().data('ajax-url') + '/start_gated_exam';
      $.post(
        action_url,
        {},
        function(data) {
          // reload the page, because we've unlocked it
          location.reload();
        }
      );
    }
  );
</script>
% else:
<script type="text/javascript">
  var sequenceNav;
  $(document).ready(function() {
    sequenceNav = new SequenceNav($('.sequence-nav'));
  });
</script>
% endif
